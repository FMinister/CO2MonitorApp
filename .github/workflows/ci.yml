name: Build and Release Flutter App

on:
    push:
        branches:
            - main

jobs:
    build:
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v3

            - name: Setup Java
              uses: actions/setup-java@v3
              with:
                  distribution: "zulu"
                  java-version: "17"

            - name: Set up Flutter
              uses: subosito/flutter-action@v1
              with:
                  flutter-version: "3.7.11"

            - name: Install dependencies
              run: flutter pub get

            - name: Build APK for Android
              run: flutter build apk

            - name: Build App Bundle for Android
              run: flutter build appbundle

            - name: Build EXE for Windows
              run: flutter build windows

            - name: Create release
              uses: softprops/action-gh-release@v1
              with:
                  files: |
                      build/app/outputs/flutter-apk/app-release.apk
                      build/linux/x64/release/bundle/co2app
                      build/windows/runner/release/co2app.exe
                  tag_name: ${{ github.ref }}
                  title: Release CO2App
              env:
                  GITHUB_TOKEN: ${{ secrets.ACTION_SECRET }}
